<!DOCTYPE html> 
<html> 
	<head> 
		<title>Search - whichElement</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<link rel="stylesheet" href="/css/main.css" />
		<script type="text/javascript" src="/js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="/js/html5shiv.js"></script>
        <script type="text/javascript" src="/js/engine.js"></script>
		<script type="text/javascript" src="http://use.typekit.com/div2vlq.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
		<script type="text/javascript" src="/js/main.js"></script>

		<script type="text/javascript">
			$(document).ready(function() {

				var vars = getURLVars();

				if (vars['q'] != null &&  vars['q'].length > 0){
					$.get('searchindex.js', function(data) {
						handleSearchIndexRetreval(data, vars['q']);
					});
				}

				$('#searchForm').submit(function(e){
						var searchTerm = $('#q').val();
						console.log(searchTerm);
						$.get('searchindex.js', function(data) {
							handleSearchIndexRetreval(data, searchTerm);
						});
						return false;
					}
				);



			})




			function handleSearchIndexRetreval(data, searchTerm){
				var searchIndex = JSON.parse(data);
				var hits = searchForTerm(searchTerm, searchIndex)
				var results = createSearchResultHTML(hits, searchTerm);
				$('#resultblock').html(results);
			}


			function searchForTerm(searchTerm, searchIndex){
				var hits = [];

				for (var i = 0; i < searchIndex.length; i++){
					var filter = searchIndex[i]['title'].toLowerCase().indexOf(searchTerm.toLowerCase());
					filter += searchIndex[i]['summary'].toLowerCase().indexOf(searchTerm.toLowerCase());

					if (filter >= 0){
						hits.push(searchIndex[i]);
					}
				}

				return hits;
			}

			function createSearchResultHTML(hits, searchTerm){
				if (hits.length > 0){
					
					var resultWord = "results";
					
					if (hits.length == 1){
						resultWord = "result";
					}


						var results = "<h3>Results</h3>";
						results += "<p>Search yielded " + hits.length + " " + resultWord + " for <mark>" + searchTerm + "</mark>.</p>";
						results += "<dl>";
						for (var i = 0; i < hits.length; i++){
							var summary = hits[i]['summary'].replace(searchTerm, "<mark>" + searchTerm + "</mark>")
							var result = "<dt>" + (i+1)  + ". ";
							result += '<a href="' + hits[i]['url'] + '">' + hits[i]['title'] + '</a>';
							result += "</dt>"
							result += "<dd>";
							result += summary;
							result += "</dd>"
							results += result;
						}

						results += "<dl>";
						
					}
					else{
						var results = "<h3>No results</h3>";
						results += "<p>We never thought to write about <mark>" + searchTerm + "</mark> before. Hopefully we will soon.</p>";
					}
				return results;
			}

			function getURLVars(){
				var vars = [], hash;
			    var q = document.URL.split('?')[1];
			    if(q != undefined){
			        q = q.split('&');
			        for(var i = 0; i < q.length; i++){
			            hash = q[i].split('=');
			            vars.push(hash[1]);
			            vars[hash[0]] = hash[1];
			        }
				}
				return vars;
			}

		</script>



	</head> 
	<body id="searchpage"> 
		<header>
			<hgroup>
				<h1><a href="/">whichElement?</a></h1>
				<h2>Trying to answer that age old question:</h2>
				<h2><em>Should that be a div, a span, or something else?</em></h2>
			</hgroup>
			<div id="forkme"><a href="http://github.com/tpryan/whichelement">Fork me on GitHub</a></div>
			<nav>
				<ul>
					<li><a href="/">Home</a></li>
					<li><a href="/contribute">Contribute</a></li>
					<li><a href="/about">About</a></li>
				</ul>
			</nav>
		</header>
		<div id="content">
			<div id="breadcrumbs">
				<span id="tagcrumb">Search</span>
			</div>
			<article>
			<h2>Search</h2>
				<form id="searchForm" >
					<input type="search" name="q" id="q" placeholder="Search" />
					<input type="submit" name="submit" id="submit" value="Go!" />
				</form>

			<div id="resultblock">
				<p>Go ahead and search.  If we got it, we'll let you know.</p>
			</div>

			</article>
		</div>
		<footer>
			<p><a href="/">whichElement</a> is meant to be a group effort. 
				Please <a href="/contribute">pitch in.</p>  
				
		</footer>
		<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-28728908-1']);
		  _gaq.push(['_trackPageview']);
		
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		
		</script>
	</body>
</html>